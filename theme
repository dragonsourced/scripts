#!/bin/sh

THEMEFILE=/tmp/theme

themes() {
    echo light
    echo dark
}

statusbar()
{
    killall status
    killall lemonbar
    status "$THEME" &
}

wallpaper()
{
    feh --bg-fill "$HOME/pics/wall/$THEME"
}

term()
{
    [ "$THEME" = light ] && cflags="-DLIGHT_THEME=1"
    export BINDIR="$HOME/bin"
    (
        cd "$HOME/src/ui/st"
        make clean
        make install CFLAGS="$cflags"
    )
}

notifications()
{
    killall dunst
    install -D "$HOME/src/ui/dunst/$THEME" ~/.config/dunst/dunstrc
    dunst &
}

rofi()
{
    sed -i "s/rofi\\.theme:.*$/rofi.theme:         $THEME.rasi/" ~/.config/rofi/config
}

spotify()
{
    spicetify config current_theme "$THEME"
    spicetify update
}

gtk() {
    export GTK_THEME="oomox-$THEME"
    export ICON_THEME="oomox-$THEME"
    export FONT="Iosevka 10"

    # Set GTK theme via xsettings.
    xfconf-query -c xsettings -p /Net/ThemeName -s "$GTK_THEME"
    xfconf-query -c xsettings -p /Net/IconThemeName -s "$ICON_THEME"
    xfconf-query -c xsettings -p /Gtk/FontName -s "$FONT"
}

switchto() {
    export THEME="$*"
    echo "$THEME" > "$THEMEFILE"
    term &
    gtk
    rofi
    wallpaper
    statusbar
    notifications
    spotify
}

case $* in
    light) switchto light ;;
    dark)  switchto dark  ;;
    menu)  $0 "$(themes | menu)" ;;
    list)  themes ;;
    "")    cat "$THEMEFILE" ;;
    *)
        echo "Usage: $0 <theme>"
        echo "       $0 list"
        echo "       $0 menu"
        ;;
esac
