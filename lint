#!/bin/sh

_sh() {
	shellcheck "$1"
}

_c() {
	cppcheck "$1"
}

_cpp() {
	cppcheck "$1"
}

_err() {
	echo "$0: $*" > /dev/stderr
}

_recurse() {
	for f in $(find "$1" -type f | sed 's/^\.\///' | grep -v .git); do
		lint "$f"
	done
}

while [ "$1" ]; do
	[ -d "$1" ] && (_recurse "$1"; shift)
	case $1 in
		Makefile|makefile|GNUmakefile)
		# I don't actually know a way to lint makefiles.
		;;

		*.sh) _sh "$1" ;;
		*.c|*.h) _c "$1" ;;
		*.cc|*.cpp|*.hpp) _cpp "$1" ;;
		*.lua) luacheck "$1" ;;
		*.*) _err "no default linter for $1";;
		*) _sh "$1" ;;
	esac
	shift
done
